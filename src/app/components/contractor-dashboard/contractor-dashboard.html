<!-- src/app/components/contractor-dashboard/contractor-dashboard.html -->
<div class="contractor-dashboard">
  <div class="container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="dashboard-header">
      <h1 class="page-title">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—Ä—è–¥—á–∏–∫–∞</h1>
      
      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div class="stats-grid">
        <div class="stat-card stat-total">
          <div class="stat-number">{{ stats.total }}</div>
          <div class="stat-label">–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</div>
        </div>
        <div class="stat-card stat-pending">
          <div class="stat-number">{{ stats.pending }}</div>
          <div class="stat-label">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</div>
        </div>
        <div class="stat-card stat-approved">
          <div class="stat-number">{{ stats.approved }}</div>
          <div class="stat-label">–û–¥–æ–±—Ä–µ–Ω–æ</div>
        </div>
        <div class="stat-card stat-progress">
          <div class="stat-number">{{ stats.inProgress }}</div>
          <div class="stat-label">–í —Ä–∞–±–æ—Ç–µ</div>
        </div>
        <div class="stat-card stat-completed">
          <div class="stat-number">{{ stats.completed }}</div>
          <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
        </div>
      </div>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
    <div class="filters-section">
      <div class="filters-row">
        <div class="search-box">
          <input 
            type="text" 
            [(ngModel)]="searchTerm" 
            (input)="filterApplications()"
            placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç—É –∏–ª–∏ –ø—Ä–æ–µ–∫—Ç—É..."
            class="search-input"
          >
          <span class="search-icon">üîç</span>
        </div>
        
        <div class="status-filters">
          <select 
            [(ngModel)]="statusFilter" 
            (change)="filterApplications()"
            class="status-select"
          >
            <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            <option value="Pending">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>
            <option value="Approved">–û–¥–æ–±—Ä–µ–Ω–æ</option>
            <option value="InProgress">–í —Ä–∞–±–æ—Ç–µ</option>
            <option value="Completed">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</option>
            <option value="Rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</option>
          </select>
        </div>
      </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ -->
    <div class="applications-table">
      <div *ngFor="let application of filteredApplications" class="application-row">
        
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="application-main">
          <div class="client-info">
            <h4 class="client-name">{{ application.client?.fullName }}</h4>
            <div class="client-contacts">
              <span class="contact-email">{{ application.client?.email }}</span>
              <span class="contact-phone">{{ application.client?.phone }}</span>
            </div>
          </div>

          <div class="project-info">
            <h4 class="project-name">{{ application.project?.name }}</h4>
            <div class="project-price">{{ application.project?.price | number:'1.0-0' }} ‚ÇΩ</div>
          </div>

          <div class="application-meta">
            <div class="application-date">
              –ü–æ–¥–∞–Ω–∞: {{ formatDate(application.createdAt) }}
            </div>
            <div class="status-badge" [class]="'status-' + getStatusInfo(application.status).color">
              {{ getStatusInfo(application.status).label }}
            </div>
          </div>
        </div>

        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
        <div class="comments-section">
          <div class="comment-block" *ngIf="application.clientComments">
            <strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–ª–∏–µ–Ω—Ç–∞:</strong>
            <p>{{ application.clientComments }}</p>
          </div>
          
          <div class="comment-block" *ngIf="application.contractorComments">
            <strong>–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong>
            <p>{{ application.contractorComments }}</p>
          </div>

          <!-- –§–æ—Ä–º–∞ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –ø–æ–¥—Ä—è–¥—á–∏–∫–∞ -->
          <div class="contractor-comment-form">
            <textarea 
              #commentInput
              placeholder="–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞..."
              rows="2"
              class="comment-textarea"
            ></textarea>
            <button 
              (click)="addContractorComments(application, commentInput.value); commentInput.value = ''"
              class="btn btn-primary btn-sm"
            >
              –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
            </button>
          </div>
        </div>

        <!-- –î–µ–π—Å—Ç–≤–∏—è –ø–æ–¥—Ä—è–¥—á–∏–∫–∞ -->
        <div class="contractor-actions">
          <div class="action-buttons">
            <button 
              *ngIf="application.status === 'Pending'"
              (click)="updateApplicationStatus(application, 'Approved')"
              class="btn btn-success btn-sm"
            >
              ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
            </button>
            
            <button 
              *ngIf="application.status === 'Pending'"
              (click)="updateApplicationStatus(application, 'Rejected')"
              class="btn btn-danger btn-sm"
            >
              ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
            </button>
            
            <button 
              *ngIf="application.status === 'Approved'"
              (click)="updateApplicationStatus(application, 'InProgress')"
              class="btn btn-info btn-sm"
            >
              üöÄ –í —Ä–∞–±–æ—Ç—É
            </button>
            
            <button 
              *ngIf="application.status === 'InProgress'"
              (click)="updateApplicationStatus(application, 'Completed')"
              class="btn btn-primary btn-sm"
            >
              ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å
            </button>
          </div>

          <!-- –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ -->
          <div class="status-history">
            <small>–û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ formatDate(application.updatedAt) }}</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>